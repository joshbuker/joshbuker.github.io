<meta name="robots" content="index, follow">

{%- capture seo_tags -%}
  {% seo title=false %}
{%- endcapture -%}

<!-- Setup Open Graph image -->

{% if page.image %}
  {% assign src = page.image.path | default: page.image %}

  {% unless src contains '://' %}
    {%- capture img_url -%}
        {% include media-url.html src=src subpath=page.media_subpath absolute=true %}
      {%- endcapture -%}

    {%- capture old_url -%}{{ src | absolute_url }}{%- endcapture -%}
    {%- capture new_url -%}{{ img_url }}{%- endcapture -%}

    {% assign seo_tags = seo_tags | replace: old_url, new_url %}
  {% endunless %}

{% elsif site.social_preview_image %}
  {%- capture img_url -%}
      {% include media-url.html src=site.social_preview_image absolute=true %}
    {%- endcapture -%}

  {%- capture og_image -%}
      <meta property="og:image" content="{{ img_url }}" />
    {%- endcapture -%}

  {%- capture twitter_image -%}
      <meta name="twitter:card" content="summary_large_image" />
      <meta property="twitter:image" content="{{ img_url }}" />
    {%- endcapture -%}

  {% assign old_meta_clip = '<meta name="twitter:card" content="summary" />' %}
  {% assign new_meta_clip = og_image | append: twitter_image %}
  {% assign seo_tags = seo_tags | replace: old_meta_clip, new_meta_clip %}
{% endif %}

{{ seo_tags }}

{%- if site.social.fediverse_handle %}
  <!-- Fediverse handle/creator -->
  <meta name="fediverse:creator" content="{{ site.social.fediverse_handle }}">
{% endif %}

{%- if page.layout == 'post' %}
  <!-- Article metadata for posts -->
  <!-- Author(s) -->
  {% if page.author -%}
    {% assign authors = page.author %}
  {%- elsif page.authors -%}
    {% assign authors = page.authors %}
  {%- elsif site.author -%}
    {% assign authors = site.author %}
  {%- endif -%}

  {% if authors -%}
    {%- for author in authors -%}
      <meta property="article:author" content="{{ site.data.authors[author].name }}">
    {%- endfor -%}
  {%- endif -%}

  {% comment %}
    <!-- Published (provided by Jekyll SEO) -->
    {%- if page.date %}
      <meta property="article:published_time" content="{{ page.date }}">
    {%- endif %}
  {% endcomment %}

  <!-- Modified Date -->
  {% if page.last_modified_at -%}
    <meta property="article:modified_time" content="{{ page.last_modified_at }}">
  {%- endif %}

  <!-- Category -->
  {% if page.category -%}
    <meta property="article:section" content="{{ page.category }}">
  {%- elsif page.categories and page.categories.size > 0 -%}
    <meta property="article:section" content="{{ page.categories.first }}">
  {%- endif %}

  <!-- Tags -->
  {% for tag_name in page.tags %}
    <meta property="article:tag" content="{{ tag_name }}">
  {%- endfor -%}
  {% if page.tags.size > 0 %}
    {% assign keywords = page.tags | join: ', ' %}
    <meta name="keywords" content="{{ keywords }}">
  {% endif -%}
{%- endif -%}
